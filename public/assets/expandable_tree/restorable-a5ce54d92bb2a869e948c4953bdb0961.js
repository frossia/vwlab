(function(){window.is_restorable_tree=!0,this.TSTconst=function(){function e(){}return e._name="TST",e.delimiter=";",e.separator="|",e.re=function(){return new RegExp(this.cookie_name()+"\\"+this.separator)},e.hash_prefix=function(){return this.cookie_name()+this.separator},e.cookie_scope=function(){return $(".sortable_tree").data("cookie_scope")||$(".sortable_tree").data("cookie-scope")},e.cookie_name=function(){return this.cookie_scope()?this._name+"_"+this.cookie_scope():this._name},e}(),this._get_hash=function(){return document.location.hash},this._set_hash=function(e){return window.skip_expandable_tree_hashchange=!0,document.location.hash=e},this._uniqueArray=function(e){var t,n,r,o,a,s,_;for(null==e&&(e=[]),r={},a=0,s=e.length;s>a;a++)t=e[a],r[t]=t;_=[];for(n in r)o=r[n],_.push(o);return _},this._compactArray=function(e){return e.filter(function(e){return e})},this._nested_set_hash_arr=function(e){var t,n,r;return e?(r=e.split(TSTconst.separator),n=r[0],t=r[1],_compactArray(_uniqueArray(t.split(TSTconst.delimiter)))):[]},this.nested_tree_get_path=function(){var e;return e=_get_hash(),e.match(TSTconst.re())?_nested_set_hash_arr(e):!1},this.hash_and_cookie_accordance=function(){var e,t;if(window.is_cookie_restoreable_tree)if(e=_get_hash(),0===e.length)$.removeCookie(TSTconst.cookie_name());else{if(!e.match(TSTconst.re()))return!1;t=e.split(TSTconst.separator)[1],$.cookie(TSTconst.cookie_name(),t,{expires:14})}return!1},this.nested_tree_path_remove=function(e){var t,n,r,o;return n=_get_hash(),n.match(TSTconst.re())?(t=_nested_set_hash_arr(n),r=t.indexOf(e+""),-1===r?hash_and_cookie_accordance():(t.splice(r,1),o=_uniqueArray(t).join(TSTconst.delimiter),_set_hash(0===o.length?"":TSTconst.hash_prefix()+o),hash_and_cookie_accordance(),!0)):!1},this.nested_tree_path_add=function(e){var t,n,r;return r=e,n=_get_hash(),n.match(TSTconst.re())&&(t=_nested_set_hash_arr(n),t.push(e),t=_uniqueArray(t),r=t.join(TSTconst.delimiter)),_set_hash(TSTconst.hash_prefix()+r),hash_and_cookie_accordance()},this.load_nested_nodes=function(e,t){var n,r,o,a;return 0===e.length?(window.skip_expandable_tree_hashchange=!1,!1):(r=e.shift(),a=$(".sortable_tree"),o=$("[data-node-id="+r+"]"),n=$("i.handle, b.expand",a),0===o.length?load_nested_nodes(e,t):$.ajax({type:"POST",dataType:"html",data:{id:r},url:t,beforeSend:function(){return n.hide(),window.skip_expandable_tree_hashchange=!0},success:function(r){return n.show(),append_children_to_node(o,r),load_nested_nodes(e,t)},error:function(e,t,n){try{return console.log(n)}catch(r){}}}))},this.restore_nested_tree=function(e,t){var n;return n=nested_tree_get_path(),n?load_nested_nodes(n,t):!1}}).call(this);